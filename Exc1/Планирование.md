# Планирование: анализ, идентификация проблем и поиск решений

## Проблемы

- отсутствие наблюдаемости. Этому вопросу в целом будет посвящены 2,3 и 4 задание, но по симптомам ясно что где-то случаются ошибки, но об этом никто не знает, что свидетельствует об отсутствии наблюдаемости в системе как класса. Иначе "Александрит" не узнавал бы о проблемах от клиентов
- значительные задержки релизов. Учитывая модель бизнеса и клиентов, медленные обновления (которые к тому же не решают проблемы) сильно вредят бизнесу
  - посредственное тестирование (только ручное сквозное и автоматизированные unit). Отсутствие автоматизированного системного и интеграционного тестирования не позволяет обнаруживать проблемы в процессе разработки
- слишком долгая работа расчёта стоимости модели (MES). Принимать на обработку случайные 3d модели является сомнительной практикой. Добавление первичной оценки модели (пространственная сложность, валидация, проверка топологии, в перспективе оптимизация) на стороне браузера клиента или отдельным модулем позволило бы значительно уменьшить затраты времени на расчёт на стороне MES
- "утеря" заказов в системе (CRM и API пользователи)
  - статусы заказов не учитывают возможность возникновения каких-либо ошибок. Банальное добавление статуса начала операции и состояния "ошибка" позволило бы довольно эффективно проводить отслеживание проблем с заказом, при условии что прочих проблем не существовало
  - архитектурные проблемы
    - фрагментированное хранение и управление состоянием заказа. Судя по C4 описанию, хранение состояний заказа происходит в двух различных базах данных, причём состояние заказа не просто несогласованно, а независимо, в одной БД хранится состояние с точки зрения клиента, в другой с точки зрения производства
    - публичная доступность внутреннего API. По условиям задания с точки зрения authN/authZ всё хорошо, так что опустим моменты безопасности. API удобно для клиента, но ещё больше фрагментирует управление состоянием заказа
- медленная работа MES для внутренних потребителей

## Инициативы

- выделение отдельного микросервиса "Orders". Необходимо централизовать управление состоянием заказа в системе, это повысит прозрачность мониторинга состоянием заказа, а также снизит вероятность потери заказов в системе. Плюс при использовании API у клиентов сохранится возможность полноценного использование веб-сайта
- дополнительный модуль для работы с 3д моделями (валидация, исправление, упрощение)
- трейсинг
- логирование
- мониторинг
- кеширование
- расширенное автоматизированное тестирование
- более щадящий график релизов. Если график релизов каждые 2 недели не работает и тенденция только ухудшается, ясно что решить такую проблему очень быстро не получится. Поэтому имеет смысл перейти к более щадящему графику, тем более что он всё равно не выдерживался

## Приоритезация инициатив

- логирование
- расширенное автоматизированное тестирование
- мониторинг
- выделение отдельного микросервиса "Orders"
- кеширование
- дополнительный модуль для работы с 3д моделями
- трейсинг

- более щадящий график релизов (это больше организационный момент, можно имплементировать независимо от пунктов выше) 

### Аргументация

Основная текущая проблема "Александрита" звучит как: "Мы теряем клиентов". Поэтому основные усилия должны быть направлены именно в сторону удержания текущих клиентов, т.е. снижения их недовольства. На мой взгляд тут есть два основных направления работы:

- инженерное, т.е. устранение проблем, вызывающих недовольство
- социальное, т.е. взаимоотношения с клиентами, особенно с крупными. Сюда, например, можно отнести инициативу про смену графика релизов. Чётко соблюдаемый график релизов, пусть и не столь частых, по моим наблюдениям, важнее для крупных организаций, у которых довольно большая инерция внутренних процессов.

С инженерной, если выбирать только 3 инициативы, то в первую очередь стоит внедрить централизованный сбор структурированных логов. Это не самое оптимальное решение с точки зрения внедрения изменений, но в текущий момент нужен инструмент, который позволит локализовать проблемы и сделать это быстро. На внедрение логирования уйдёт наименьшее кол-во времени и это привычный для программистов инструмент анализа.

Дальше, с моей точки зрения, идёт расширенное автоматизированное тестирование. Нужна стабильность, не только в работе системы, но и в выпуске релизов.

Наконец нужно добавить мониторинг. Нам нужно повысить надёжность и ускорить время решения проблем. Помимо этого он позволит уточнить дальнейшую стратегию развития продукта.

В целом, как и в реальной жизни, архитектурные изменения не находятся в приоритете.

## Виденье будущего

На мой взгляд, в ближайшие полгода не будет много архитектурных изменений. Основные усилия будут сконцентрированы на стабилизации как процессов разработки, так и самой системы. Изменения в архитектуре можно проводить уже после того как компания будет уверена что не потеряет текущих клиентов. Наблюдаемость во всех своих проявлениях на данном этапе важнее. Перед архитектурными изменениями лучше иметь возможность идентифицировать узкие места и оценить эффективность и последствия изменений. А также иметь возможность правильности работы системы после оных.
